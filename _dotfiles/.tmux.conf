# Many of the following settings are from Ham Vocke. Thank you mate -> https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/

# ==============================================================================
# GENERAL SETTINGS
# ==============================================================================

# Modern terminal settings
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -ag terminal-overrides ",alacritty:RGB"

# Faster escape time (important for vim/neovim)
set -sg escape-time 0

# Increase scrollback buffer
set -g history-limit 50000

# Enable focus events (for vim/neovim autoread)
set -g focus-events on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Automatically rename windows based on current program
setw -g automatic-rename on

# Display messages for longer
set-option -g display-time 4000
set-option -g display-panes-time 3000

# Enable mouse support (can be toggled)
set -g mouse on

# Quiet mode - no bells or visual notifications
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# ==============================================================================
# KEY BINDINGS - SPLITS AND WINDOWS
# ==============================================================================

# Remap " % to [ ] for splits (keeping current path)
bind -n M-[ split-window -v -c "#{pane_current_path}"
bind -n M-] split-window -h -c "#{pane_current_path}"
unbind '"'
unbind %

# Full-width/height splits
bind -n M-S-[ split-window -fv -c "#{pane_current_path}"
bind -n M-S-] split-window -fh -c "#{pane_current_path}"

# Window selection with Alt+number
bind -n M-0 select-window -t 0
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Window navigation
bind -n M-n select-window -n
bind -n M-p select-window -p
bind -n M-c new-window -c "#{pane_current_path}"
bind -n M-w kill-window
bind -n M-Tab last-window
bind -n M-, command-prompt -I "#W" "rename-window '%%'"

# Swap windows left/right
bind -n M-< swap-window -t -1\; select-window -t -1
bind -n M-> swap-window -t +1\; select-window -t +1

# ==============================================================================
# KEY BINDINGS - PANE MANAGEMENT
# ==============================================================================

# Zoom toggle
bind -n M-z resize-pane -Z

# Switch panes using Alt-arrow
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Switch panes using Alt-hjkl (vim-style)
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-k select-pane -U
bind -n M-j select-pane -D

# Resize panes with Shift+Alt+arrow
bind -n M-S-Left resize-pane -L 5
bind -n M-S-Right resize-pane -R 5
bind -n M-S-Up resize-pane -U 5
bind -n M-S-Down resize-pane -D 5

# Resize panes with Shift+Alt+hjkl
bind -n M-H resize-pane -L 5
bind -n M-L resize-pane -R 5
bind -n M-K resize-pane -U 5
bind -n M-J resize-pane -D 5

# Swap panes
bind -n 'M-{' swap-pane -U
bind -n 'M-}' swap-pane -D

# Kill pane without confirmation
bind -n M-x kill-pane

# Break pane into new window
bind -n M-! break-pane

# Join pane from another window (interactive)
bind @ choose-window 'join-pane -h -s "%%"'

# Rotate panes
bind -n M-o rotate-window

# ==============================================================================
# KEY BINDINGS - LAYOUTS
# ==============================================================================

# Quick layout switching
bind -n M-Enter next-layout

# Specific layouts with prefix
bind = select-layout even-horizontal
bind | select-layout even-vertical
bind _ select-layout main-horizontal
bind \\ select-layout main-vertical
bind + select-layout tiled

# ==============================================================================
# KEY BINDINGS - SESSIONS
# ==============================================================================

# Session management
bind -n M-s choose-tree -Zs
bind -n M-S new-session
bind -n M-d detach-client
bind -n M-$ command-prompt -I "#S" "rename-session '%%'"

# Quick switch to last session
bind -n M-\\ switch-client -l

# ==============================================================================
# KEY BINDINGS - COPY MODE
# ==============================================================================

# Vi-style copy mode
setw -g mode-keys vi

# Enter copy mode
bind -n M-v copy-mode
bind -n M-/ copy-mode \; send-keys /

# Copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Paste from tmux buffer
bind -n M-P paste-buffer

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ==============================================================================
# KEY BINDINGS - UTILITY
# ==============================================================================

# Reload config
bind -n M-r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Toggle mouse on/off
bind m set -g mouse \; display-message "Mouse: #{?mouse,ON,OFF}"

# Synchronize panes (send same input to all panes)
bind -n M-y setw synchronize-panes \; display-message "Sync: #{?synchronize-panes,ON,OFF}"

# Clear screen and scrollback
bind -n M-C send-keys C-l \; run 'sleep 0.1' \; clear-history

# Open command prompt
bind -n M-: command-prompt

# List all keybindings
bind ? list-keys

# Capture pane content to file
bind P capture-pane -S -50000 \; save-buffer ~/tmux-capture.txt \; display-message "Pane captured to ~/tmux-capture.txt"

# ==============================================================================
# KEY BINDINGS - NAVIGATION KEYS
# ==============================================================================

# Home/End - Send to shell for line editing
bind-key -n Home send-keys C-a
bind-key -n End send-keys C-e

# Page Up/Page Down - Enter copy mode and scroll buffer
bind-key -n Page-Up copy-mode -u
bind-key -n Page-Down send-keys Page-Down

# Copy mode navigation
bind-key -T copy-mode-vi Home send-keys -X start-of-line
bind-key -T copy-mode-vi End send-keys -X end-of-line
bind-key -T copy-mode-vi Page-Up send-keys -X page-up
bind-key -T copy-mode-vi Page-Down send-keys -X page-down

# Ctrl+Home/Ctrl+End - Enter copy mode and scroll to buffer top/bottom
bind-key -n C-Home copy-mode \; send-keys -X history-top
bind-key -n C-End copy-mode \; send-keys -X history-bottom

# Ctrl+Home/Ctrl+End in copy mode
bind-key -T copy-mode-vi C-Home send-keys -X history-top
bind-key -T copy-mode-vi C-End send-keys -X history-bottom

# ==============================================================================
# APPEARANCE - STATUS BAR
# ==============================================================================

set -g status-position top
set -g status-justify left
set -g status-style 'bg=#1a1b26 fg=#a9b1d6'

# Update status bar more frequently (for real-time system monitoring)
set -g status-interval 2

# Left side: session, user, window/pane count
set -g status-left-length 120
set -g status-left '#[fg=#1a1b26,bg=#7aa2f7,bold] #S #[fg=#1a1b26,bg=#9ece6a] #(whoami) #[fg=#9ece6a,bg=#1a1b26] #[fg=#565f89]│ #(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py window_count; fi) #[fg=#565f89]│ '

# Right side: system info, git, pane info, date, time
set -g status-right-length 280
set -g status-right '#[fg=#565f89]│ #{?client_prefix,#[fg=#f7768e]PREFIX #[fg=#565f89]│ ,}#{?synchronize-panes,#[fg=#bb9af7]SYNC #[fg=#565f89]│ ,}#(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py uptime; fi) #[fg=#565f89]│ #(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py network; fi) #[fg=#565f89]│ #(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py battery; fi) #[fg=#565f89]│ #(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py disk_usage; fi) #[fg=#565f89]│ #(if [ -f ~/.scripts/tmux/status_elements.py ]; then ~/.scripts/tmux/status_elements.py cpu_mem; fi) #[fg=#565f89]│ #(gitmux -cfg ~/.gitmux.conf "#{pane_current_path}") #[fg=#565f89]│ #[fg=#7aa2f7]#I:#P #[fg=#565f89]│ #[fg=#9ece6a]%Y-%m-%d #[fg=#565f89]│ #[fg=#7aa2f7]%H:%M:%S '

# ==============================================================================
# APPEARANCE - WINDOWS
# ==============================================================================

# Window status format with pane count and better indicators
# Format: [index]:[name][pane_count][flags]
set -g window-status-format '#[fg=#565f89]│ #[fg=#a9b1d6]#I:#W#[fg=#7dcfff]#{?#{>:#{window_panes},1},(#{window_panes}),}#[fg=#e0af68]#{?window_zoomed_flag,Z,}#[fg=#f7768e]#{?window_activity_flag,!,}#[fg=#bb9af7]#{?window_bell_flag,B,}#[fg=#565f89] '

# Current window format (highlighted)
set -g window-status-current-format '#[fg=#565f89]│ #[fg=#1a1b26,bg=#7aa2f7,bold] #I:#W#[fg=#1a1b26,bg=#7dcfff]#{?#{>:#{window_panes},1},(#{window_panes}),}#[fg=#1a1b26,bg=#e0af68]#{?window_zoomed_flag,Z,}#[fg=#565f89] '

# Window status separator (using box-drawing characters)
set -g window-status-separator ''

# Activity and bell styles
set -g window-status-activity-style 'fg=#f7768e bg=#1a1b26 bold'
set -g window-status-bell-style 'fg=#bb9af7 bg=#1a1b26 bold'

# ==============================================================================
# APPEARANCE - PANES
# ==============================================================================

set -g pane-border-style 'fg=#3b4261'
set -g pane-active-border-style 'fg=#7aa2f7'

# Pane number display
set -g display-panes-colour '#565f89'
set -g display-panes-active-colour '#7aa2f7'

# ==============================================================================
# APPEARANCE - MESSAGES AND MODES
# ==============================================================================

set -g message-style 'fg=#1a1b26 bg=#7aa2f7 bold'
set -g message-command-style 'fg=#1a1b26 bg=#bb9af7 bold'

setw -g clock-mode-colour '#7aa2f7'
setw -g mode-style 'fg=#1a1b26 bg=#bb9af7 bold'

# ==============================================================================
# WINDOW TITLES
# ==============================================================================

set-option -g set-titles on
set-option -g set-titles-string '#H - #S - #W'

# ==============================================================================
# PLUGINS
# ==============================================================================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'b0o/tmux-autoreload'
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'
set -g @plugin 'rickstaa/tmux-notify'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'sainnhe/tmux-fzf'

# New plugins
set -g @plugin 'alexwforsythe/tmux-which-key'      # Keybinding cheatsheet popup
set -g @plugin 'laktak/extrakto'                   # fzf copy from scrollback
set -g @plugin 'fcsonline/tmux-thumbs'             # Quick copy with hints
set -g @plugin 'christoomey/vim-tmux-navigator'    # Seamless vim/tmux navigation
set -g @plugin 'wfxr/tmux-fzf-url'                 # Quick URL opener
set -g @plugin 'arl/gitmux'                        # Git status in status bar

# ==============================================================================
# PLUGIN SETTINGS
# ==============================================================================

# Sidebar
set -g @sidebar-tree-width '100'

# Session persistence
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '10'

# tmux-fzf
TMUX_FZF_LAUNCH_KEY="f"

# tmux-thumbs (quick copy)
set -g @thumbs-key F
set -g @thumbs-unique enabled
set -g @thumbs-command 'echo -n {} | pbcopy'

# extrakto (fzf copy from scrollback)
set -g @extrakto_key 'e'
set -g @extrakto_copy_key 'tab'
set -g @extrakto_insert_key 'enter'

# tmux-fzf-url
set -g @fzf-url-bind 'u'

# vim-tmux-navigator (Ctrl+hjkl to move between vim/tmux)
# Note: Also install the vim plugin for full integration

# Initialize TPM (keep at bottom)
run -b '~/.tmux/plugins/tpm/tpm'
